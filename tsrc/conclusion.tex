%In this section, one should summarize the work: the problem, the current work, the proposed solution, the results obtained, and why they improve the state of the art. Repeating what is written in the introduction is not a problem and is desirable, but one should try to use different and complementary explanations to help the user. 

%Background
Established by the ISO~\cite{iso} and IEC~\cite{iec}, the MPEG working group creates standards for media coding. Since its formation in 1988, the MPEG working group has made an indelible mark on the transition from analog to digital video. In particular, an increasing number of broadcasting applications are based on MPEG technology, such as DSS~\cite{dss}, DAB~\cite{dab}, and DVB~\cite{dvb}.\\
The MPEG standard includes two variations, MPEG-1 and MPEG-2, with both covering audio and video compression. Today, MPEG-1 Audio is the most widely compatible lossy audio format in the world. The MPEG standard also differentiates three coding schemes, called Layer I, Layer II, and Layer III.  The first two layers are the most relevant ones. Layer I has the lowest complexity, while Layer II requires a more complex encoder and decoder, being directed towards one-to-many applications.

%Motivation
When developing a SoC, the developer faces tough performance-cost trade-offs and must attempt to save on any of the components. For an audio encoder, one option is buying an encoder chip, which increases area/volume, weight, and power consumption. Example chips are the \textit{CX23415 MPEG-2 Codec}~\cite{cx23415}, or the \textit{Futura II ASI+IP}~\cite{futura}). Another option is using an encoder software such as TwoLAME~\cite{twolame}. The software requires a Central Processing Unit (CPU), either one already available, or an additional CPU IP chip or IP core. The software also needs to be ported to the CPU. The last option is licensing an IP Core. This reduces reduce area/volume, weight, and power consumption, allowing the user to develop a top-notch system, beating the competition. However, it is difficult to find commercial MPEG-1/2 Layer II IP cores in the market, with one being the \textit{CWda74}, later re-branded \textit{IPB-MPEG-SE}, which uses fixed-point computations.\\
%RISC-V-based MPEG1/2 Layer II Encoder
Therefore, this work proposes a floating-point MPEG-1/2 Layer II Audio encoder, beating the \textit{CWda74} accuracy, but inevitably consuming more silicon area and burning more power. This provides a new and interesting trade-off in a market dominated by a single product.

%SW
Regarding the software architecture, the \textbf{VEXRISCV} CPU was first added to IOb-SoC due to its floating-point capabilities. Then, four audio test files were generated with \textit{Audacity} software and used to verify the quality of the original \textit{TwoLAME} software. 
With the IOb-SoC already set up, the firmware was configured to allow execution of \textit{TwoLAME} encoding algorithm, evoking all the necessary functions from the \textit{libtwolame} library. 
Some software optimizations were done after porting \textit{TwoLAME} to IOb-SoC, concerning mathematical functions, because of their computational complexity, and memory allocation. This involved substituting the mathematical operations by tables with pre-calculated values and removing several dynamic memory operations, anticipating the execution in FPGA. 
Lastly, the \textbf{TIMER} peripheral was added to IOb-SoC, allowing the \textbf{profiling} of \textit{TwoLAME} in FPGA. This process involved three stages, with the final stage representing the lowest level, exercised in \textit{twolame\_psycho\_3} function.
It was proved that \textit{psycho\_3\_threshold} occupies the biggest part of the program execution, corresponding to between 37\% and 64\% of \textit{TwoLAME} total execution time, depending on the input file.

%HW
Regarding the hardware architecture, the \textit{Versat} was first added to IOb-SoC to allow accelerating \textit{psycho\_3\_threshold} function via custom-made hardware. This required expanding the existing AXI interface in IOb-SoC, which was previously used by cache memory and CPU, and from this moment on was also providing communication between \textit{Versat} and RAM.
Knowing the resources available in \textit{Versat}, identified as Functional Units and Operators, two control and data paths were drawn to enhance developing efficient hardware designs.
Two hardware accelerators were developed and fully tested, \textit{spectrum\_search} and \textit{masking\_threshold}, each covering part of the \textit{psycho\_3\_threshold} function. Apart from organizing the hardware description in several modules inside \textit{versatSpec.txt} (the file that specifies the data process), the memory-related units have to be configured in firmware before running the \textit{Versat} accelerator, during \textit{TwoLAME} execution in IOb-SoC. 

\subsection{Achievements}

The \textit{TwoLAME} software was successfully ported to the IOb-SoC, thanks to the floating-point unit in \textit{VEXRISC} CPU.
Some software optimizations were done to reduce unnecessary operations, related to mathematical functions and memory allocation.
The \textit{profiling} was done in FPGA to determine which functions were taking most of the execution time. The \textit{psycho\_3\_threshold} was marked as the function to be accelerated using \textit{Versat}.
Two hardware accelerators were developed, each corresponding to a different part of the function.
The FPGA implementation results demonstrate the impact of using \textit{Versat} in terms of resource utilization within the FPGA. While \textit{Versat} increases certain resource utilization metrics, such as Total LUTs, Logic LUTs, and Flip-Flops, it does not affect others like DSP Blocks, RAMB36, RAMB18, and URAM.
The execution time results show a significant reduction in encoding time when using the \textit{spectrum\_search} \textit{Versat} accelerator, for all input files. The speedup achieved with this accelerator is very close to the desired speedup, demonstrating its effectiveness in improving the encoding process.
However, when comparing the achieved speedup with the required speedup for real-time encoding, it becomes evident that some input files come very close to meeting the real-time requirements. While the first input file, with a small number of frames, still falls short, the remaining input files, especially the one representing the worst-case scenario, show promising results.

\subsection{Future work}
%Another vital part of this section is to explain the future work that can be done as a follow-up to this work.

The results indicate that the proposed approach is moving in the right direction. With additional hardware accelerators in \textit{Versat}, it is likely that real-time audio encoding with MPEG-1/2 Layer II can be achieved for a wide range of input files, i.e., for any type of input file. But this requires running different accelerators in the same program execution, something that was not possible at the moment of this work but is already being developed by \textit{Versat} authors. 
Moreover, custom instructions can be created to extend \textit{VEXRISCV}, attempting to accelerate \textit{TwoLAME} horizontally.
Once the real-time requirements are achieved, this work can be compared with the  \textit{CWda74} IP Core.
These findings contribute to the ongoing efforts to provide more efficient and competitive solutions for audio encoding in MPEG-1/2 Layer II format, with the potential for real-world applications in broadcasting and multimedia.